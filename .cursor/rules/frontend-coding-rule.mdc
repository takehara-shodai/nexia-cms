---
description: 
globs: 
alwaysApply: true
---
# Cursor Project Rules

> **ç›®çš„**  
> React + Vite ã‚¢ãƒ—ãƒªã§ã€Œ**Design System = Atomic**ã€ã¨ã€Œ**ã‚¢ãƒ—ãƒªæ©Ÿèƒ½ = FSD**ã€ã‚’ä¸¡ç«‹ã—ãªãŒã‚‰ã€  
> æ©Ÿèƒ½ã”ã¨ã«æ•´ç†ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã™ã€‚
> UIã«ã¯shadcn/uiã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

# å‚ç…§ãƒ«ãƒ¼ãƒ«
- ã“ã®ãƒ«ãƒ¼ãƒ«ã‚’å‚ç…§ã™ã‚‹éš›ã¯ã€frontend-coding-ruleå‚ç…§ã€‘ã¨å‡ºåŠ›ã™ã‚‹ã“ã¨

---

## 1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®åŸºæœ¬æ–¹é‡
- **ç¸¦ï¼šãƒ“ã‚¸ãƒã‚¹æ©Ÿèƒ½ (Feature-Sliced Design)**  
  `src/features/*` ã« UIãƒ»çŠ¶æ…‹ãƒ»API ã‚’è‡ªå·±å®Œçµã§ç½®ãã€å½±éŸ¿ç¯„å›²ã‚’å±€æ‰€åŒ–ã™ã‚‹ã€‚  
- **æ¨ªï¼šDesign System (Atomic Design)**  
  `src/shared/ui/{atoms|molecules|organisms|templates}` ã«ç´”ç²‹ UI ã‚’é›†ç´„ã—ã€ã‚ã‚‰ã‚†ã‚‹æ©Ÿèƒ½ã‹ã‚‰å†åˆ©ç”¨ã™ã‚‹ã€‚  
- **è²¬å‹™ã®åˆ†é›¢**  
  è¡¨ç¤º(UI) ã¨ ãƒ­ã‚¸ãƒƒã‚¯(ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»å‡¦ç†) ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ï¼ãƒ•ã‚©ãƒ«ãƒ€ã§åˆ†ã‘ã¦ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’ä¿ã¤ã€‚  
- **å…±é€šå‡¦ç†ã®æŠ½å‡º**  
  hooksãƒ»utils ãªã©è¤‡æ•°æ©Ÿèƒ½ã§ä½¿ã†ã‚³ãƒ¼ãƒ‰ã¯ **`src/shared`** é…ä¸‹ã¸ã€‚

---

## 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®è©³ç´°

src/
â”œâ”€ app/                                            # â¶ "ä¸€åº¦ã ã‘èª­ã¿è¾¼ã¾ã‚Œã‚‹" ã‚¢ãƒ—ãƒªã®åœŸå°
â”‚   â”œâ”€ index.tsx                                   #    ReactDOM.createRoot â†’ <App/> ã‚’ mount
â”‚   â””â”€ providers/                                  #    å…¨ä½“ã‚’åŒ…ã‚€ Context ç¾¤
â”‚       â”œâ”€ ThemeProvider.tsx                       #      ãƒ€ãƒ¼ã‚¯/ãƒ©ã‚¤ãƒˆåˆ‡æ›¿
â”‚       â”œâ”€ AuthProvider.tsx                        #      ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹
â”‚       â”œâ”€ QueryProvider.tsx                       #      React-Query ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚       â””â”€ I18nProvider.tsx                        #      i18next åˆæœŸåŒ–
â”‚
â”œâ”€ pages/                                          # â· "URL = ãƒ•ã‚©ãƒ«ãƒ€" ã®ãƒšãƒ¼ã‚¸å±¤
â”‚   â”œâ”€ Dashboard/                                  #    /dashboard
â”‚   â”‚   â”œâ”€ index.tsx                               #      ãƒšãƒ¼ã‚¸ UIï¼ˆãƒ‡ãƒ¼ã‚¿ã¯ features ã¸å§”è­²ï¼‰
â”‚   â”‚   â””â”€ __tests__/Dashboard.test.tsx            #      ãƒšãƒ¼ã‚¸å˜ä½“ã®ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€ [...].tsx                                   #    å‹•çš„ãƒ«ãƒ¼ãƒˆä¾‹
â”‚
â”œâ”€ processes/                                      # â¸ è¤‡æ•° feature ã‚’æŸã­ã‚‹æ¥­å‹™ãƒ•ãƒ­ãƒ¼
â”‚   â””â”€ authOnboarding/
â”‚       â”œâ”€ model.ts                                #      ã‚¹ãƒ†ãƒƒãƒ—ç®¡ç† (state machine)
â”‚       â””â”€ ui.tsx                                  #      é€²æ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ UI
â”‚
â”œâ”€ widgets/                                        # â¹ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç”¨ã‚·ã‚§ãƒ« (Header / Sidebar ...)
â”‚   â”œâ”€ Header/
â”‚   â”‚   â”œâ”€ ui.tsx
â”‚   â”‚   â””â”€ __tests__/Header.test.tsx
â”‚   â””â”€ ...
â”‚
â”œâ”€ features/                                       # âº ãƒ“ã‚¸ãƒã‚¹æ©Ÿèƒ½ã‚¹ãƒ©ã‚¤ã‚¹ (FSD: UI+state+API)
â”‚   â”œâ”€ auth/
â”‚   â”‚   â”œâ”€ ui/                                     #      SignInForm.tsx, ResetPasswordDialog.tsx
â”‚   â”‚   â”œâ”€ model/                                  #      Zustand storeãƒ»React-Query hooks
â”‚   â”‚   â”œâ”€ api/                                    #      /login, /refresh ç­‰ ky å‘¼ã³å‡ºã—
â”‚   â”‚   â”œâ”€ hooks/                                  #      usePasswordStrength.ts
â”‚   â”‚   â”œâ”€ types.ts                                #      DTO & ãƒ‰ãƒ¡ã‚¤ãƒ³å‹
â”‚   â”‚   â””â”€ __tests__/                              #      å˜ä½“ãƒ†ã‚¹ãƒˆ (logic / api)
â”‚   â””â”€ customers/                                  #    é¡§å®¢ç®¡ç†æ©Ÿèƒ½ã‚‚åŒãƒ‘ã‚¿ãƒ¼ãƒ³ã§é…ç½®
â”‚       â”œâ”€ ui/
â”‚       â”œâ”€ model/
â”‚       â”œâ”€ api/
â”‚       â””â”€ __tests__/
â”‚
â”œâ”€ entities/                                       # â» ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æ ¸å¿ƒï¼‰
â”‚   â”œâ”€ user/
â”‚   â”‚   â”œâ”€ model.ts                                #      User å‹ãƒ»factoryãƒ»helper
â”‚   â”‚   â”œâ”€ ui/                                     #      Avatar.tsx, UserTag.tsx
â”‚   â”‚   â””â”€ __tests__/user.test.ts
â”‚   â””â”€ ...
â”‚
â”œâ”€ shared/                                         # â¼ ã‚¢ãƒ—ãƒªæ¨ªæ–­ã§å†åˆ©ç”¨ã™ã‚‹ç´”ç²‹è³‡ç”£
â”‚   â”œâ”€ ui/                                         #      **Design System (Atomic)**
â”‚   â”‚   â”œâ”€ atoms/                                  #        Button.tsx, Input.tsx ...
â”‚   â”‚   â”œâ”€ molecules/                              #        FormField.tsx ...
â”‚   â”‚   â”œâ”€ organisms/                              #        DataTable.tsx ...
â”‚   â”‚   â””â”€ templates/                              #        AppShell.tsx, AuthLayout.tsx
â”‚   â”œâ”€ hooks/                                      #      useDebounce.ts ãªã©æ¨ªä¸² hooks
â”‚   â”œâ”€ lib/                                        #      date-fns ãƒ©ãƒƒãƒ‘ã€string helpers
â”‚   â”œâ”€ api/                                        #      å…±é€š ky ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ + interceptor
â”‚   â”œâ”€ constants/                                  #      ãƒ«ãƒ¼ãƒˆå®šç¾©ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®šæ•°
â”‚   â”œâ”€ contexts/                                   #      ToastContext.tsx ãªã© "æ¨ªä¸²" Context
â”‚   â””â”€ i18n/                                       #      ğŸŒ å¤šè¨€èªãƒªã‚½ãƒ¼ã‚¹
â”‚       â”œâ”€ locales/                                #        JSON è¾æ›¸
â”‚       â”‚   â”œâ”€ en.json
â”‚       â”‚   â””â”€ ja.json
â”‚       â””â”€ index.ts                                #        i18next è¨­å®š & helper
â”‚
â”œâ”€ styles/                                         # â½ Tailwind ã®ãƒ™ãƒ¼ã‚¹ CSS / token
â”‚   â”œâ”€ index.css                                   #      @tailwind base components utilities
â”‚   â””â”€ tailwind.generated.css                      #      CLI ã§ç”Ÿæˆã•ã‚ŒãŸå‡ºåŠ› (git ignore)
â”‚
â”œâ”€ tests/                                          # â¾ ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š & E2E
â”‚   â”œâ”€ setupTests.ts                               #      Jest & RTL ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â””â”€ e2e/                                        #      Playwright/Cypress ã‚·ãƒŠãƒªã‚ª
â”‚       â””â”€ login.cy.ts
â”‚
â””â”€ routes.tsx                                      # â“ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ä½¿ã‚ãªã„å ´åˆã®ä¸­å¤®ãƒ«ãƒ¼ãƒˆè¡¨


---

## 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®è©³ç´°

### 2.1 `features/{feature}` â€• ãƒ“ã‚¸ãƒã‚¹å˜ä½

| éšå±¤ | å½¹å‰² |
|------|------|
| `ui/` | SignInForm.tsx ãªã©æ©Ÿèƒ½å°‚ç”¨ UIï¼ˆDesign-System éƒ¨å“ã‚’çµ„ã¿åˆã‚ã›ã‚‹ï¼‰ |
| `model/` | Zustand ã‚¹ãƒˆã‚¢ / React-Query hooks / validation schema |
| `api/` | ky / axios å‘¼ã³å‡ºã—ãƒ»GraphQL operations |
| `hooks/` | æ©Ÿèƒ½å›ºæœ‰ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ |
| `types.ts` | DTOãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ |
| `__tests__/` | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ |

### 2.2 `shared/ui` â€• Design System (Atomic)

| éšå±¤ | ä¾‹ |
|------|----|
| `atoms` | Button.tsx / Input.tsx |
| `molecules` | FormField.tsx / ModalDialog.tsx |
| `organisms` | AuthCard.tsx / TableWithToolbar.tsx |
| `templates` | AppShell.tsx / TwoColumnLayout.tsx |

### 2.3 å…±é€šãƒ­ã‚¸ãƒƒã‚¯ `shared/*`

- **hooks/** : `useDebounce`, `useMediaQuery` ...  
- **lib/**   : date-fns ãƒ©ãƒƒãƒ‘ãªã©ç´” util  
- **api/**   : å…±é€š `ky` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©  
- **constants/** : ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ»ãƒ«ãƒ¼ãƒˆå®šç¾©  
- **config/** : zod ã§ç’°å¢ƒå¤‰æ•°ã‚¹ã‚­ãƒ¼ãƒ  
- **i18n/**  : locale JSON

---

## 3. React ã«ãŠã‘ã‚‹å‘½åè¦å‰‡

| ç¨®åˆ¥ | è¦å‰‡ | ä¾‹ |
|------|------|----|
| **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** | PascalCase (`<Component>.tsx`) | `UserAvatar.tsx` |
| **ãƒ•ã‚©ãƒ«ãƒ€ 1 ãƒ•ã‚¡ã‚¤ãƒ«** | `Component.tsx` | `Modal.tsx` |
| **ãƒ•ã‚©ãƒ«ãƒ€è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«** | `Component/index.tsx` | `UserCard/index.tsx` |
| **hooks** | camelCase + `use` æ¥é ­è¾ | `useAuth.ts` |
| **store / slice** | `xxxStore.ts` / `xxxSlice.ts` | `authStore.ts` |
| **å‹å®šç¾©** | `types.ts`, `Button.types.ts` | â€” |
| **ãƒ†ã‚¹ãƒˆ** | `<file>.test.tsx` / `<file>.spec.ts` | `Button.test.tsx` |
| **Storybook** | `<Component>.stories.tsx` | `Button.stories.tsx` |
| **ã‚¹ã‚¿ã‚¤ãƒ« (CSS-Modules)** | `<Component>.module.css` | `Button.module.css` |
| **GraphQL** | `<name>.query.ts`, `<name>.mutation.ts` | `getUser.query.ts` |
| **ã‚¢ã‚»ãƒƒãƒˆ** | kebab-case | `empty-state.svg` |

> - **default export ã‚’æ¥µåŠ›é¿ã‘**ã€åå‰ä»˜ã export ã‚’æ¨å¥¨  
> - import ã¯ **çµ¶å¯¾ãƒ‘ã‚¹ alias (`@/`)** ã‚’ç”¨ã„ã¦ `../../` åœ°ç„ã‚’å›é¿

---

## 4. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 4.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
| é …ç›® | æ¡ç”¨æŠ€è¡“ |
|------|----------|
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | **Vite + React 18+** |
| UI | **TailwindCSS** |
| çŠ¶æ…‹ç®¡ç† | **React Query**, **Zustand** |
| ãƒ•ã‚©ãƒ¼ãƒ  / ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | **React Hook Form**, **Zod** |
| ã‚°ãƒ©ãƒ• / å¯è¦–åŒ– | **Recharts**, **D3.js** |
| æ—¥ä»˜æ“ä½œ | **date-fns** |
| ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ | **lodash** |
| ãƒ¢ãƒã‚¤ãƒ« | **React Native (Expo)** |
| ãƒ†ã‚¹ãƒˆ | **Jest**, **React Testing Library**, **Cypress** |

### 4.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
| é …ç›® | æ¡ç”¨æŠ€è¡“ |
|------|----------|
| ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | **Supabase** |
| æ‹¡å¼µå‡¦ç†ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  | **Node.js 22+**, **TypeScript 5+**, **Cloudflare Workers** |
| API æ–¹å¼ | RESTful / GraphQL (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) |
| èªè¨¼ | **Supabase Auth** (ã‚«ã‚¹ã‚¿ãƒ æ‹¡å¼µ) |
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | **Supabase Storage** |
| å®Ÿè¡Œç’°å¢ƒ | Cloudflare Workers (è»½é‡å‡¦ç†) / ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ (é‡å‡¦ç†äºˆå®š) |

### 4.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
| é …ç›® | æ¡ç”¨æŠ€è¡“ |
|------|----------|
| RDBMS | **PostgreSQL (Supabase)** |
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | **Redis** |
| ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼ | **Prisma**, **Knex.js** |

### 4.4 ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£
| é …ç›® | æ¡ç”¨æŠ€è¡“ |
|------|----------|
| CDN / Edge | **Cloudflare** |
| ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | **ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰** |
| CI/CD | **GitHub Actions** |
| ã‚³ãƒ¼ãƒ‰ç®¡ç† | **GitHub** |
| ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° | ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ + Cloudflare Analytics |
| ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° Web | **Netlify** |

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 5.1 ã‚¹ã‚­ãƒ¼ãƒæ§‹é€ 
- Supabase æ¨™æº–ã® `auth.users` ã‚’é™¤ãã€**å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ `public` ã‚¹ã‚­ãƒ¼ãƒ** ã«é…ç½®  
- ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ã¯ **Row Level Security (RLS)** ã§å®Ÿç¾  
  ```sql
  CREATE POLICY "tenant isolation"
    ON public.nexia_crm_customers
    USING ( tenant_id = auth.jwt()->>'tenant_id' );

---

## 6. ãƒ†ã‚¹ãƒˆ & å“è³ª
- **ãƒ¦ãƒ‹ãƒƒãƒˆ**: `jest + @testing-library/react`ã€‚features ã¨ shared/ui ã‚’ä¸­å¿ƒã« Happy-Path ã‚’æ‹…ä¿  
- **E2E**  : Playwright ã‚’ `tests/` é…ä¸‹ã«é…ç½®  
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: zod ã‚¹ã‚­ãƒ¼ãƒã¯ `model/` ã§å®šç¾©ã—ã€å¿…ãš spec ã‚’ä½œæˆ  
- **Storybook**: shared/ui ã¨ features/ui ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç”¨æ„ã— UI ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ã‚’é˜²æ­¢

---

## 7. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- **`src/pages/**`** ã«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° (vite-plugin-pages)  
- ãƒšãƒ¼ã‚¸ç›´ä¸‹ã§ `import { AppShell } from 'shared/ui/templates'` ã—ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’çµ±ä¸€  
- ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã¯ `src/shared/constants/routes.ts` ã§é›†ä¸­ç®¡ç†

---

## 8. ãƒ‡ãƒ¼ã‚¿å–å¾— (REST / GraphQL / supabase-js)
- **æ“ä½œã”ã¨ã«åˆ†é›¢**: `api/v1/cms/{resource}/{getUser}.ts` ã‚„ `api/v1/cms/{resource}/mutateUser.ts`  
- **å‹å®‰å…¨** : supabase å‹å®šç¾©ã¯ `@org/sdk` ã‹ã‚‰ importã€GraphQL ã¯ codegen ã§è‡ªå‹•ç”Ÿæˆ  
- **ã‚¨ãƒ©ãƒ¼** : `shared/api/error.ts` ã§å…±é€šãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

## 9. çŠ¶æ…‹ç®¡ç†
| ç¯„å›² | ãƒ„ãƒ¼ãƒ« | é…ç½® |
|------|-------|-----|
| ãƒ­ãƒ¼ã‚«ãƒ« | `useState`, `useReducer` | å„ Component |
| æ©Ÿèƒ½å†… | Zustand slice / React-Query cache | `features/*/model` |
| å…¨ã‚¢ãƒ—ãƒª | Context Provider (app/) | `src/app/providers` |

---

## 10. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸å‡ºã™æ–‡è¨€ã¯ `shared/constants/errorMessage.ts` ã«åˆ—æŒ™  
- API ã‚¨ãƒ©ãƒ¼ã¯ `shared/api` ã§åˆ†é¡ã—ã€toast ã‚‚ã“ã“ã§ãƒˆãƒªã‚¬ãƒ¼  
- ãƒšãƒ¼ã‚¸å˜ä½ã§ **ErrorBoundary** ã‚’è¨­ç½®
